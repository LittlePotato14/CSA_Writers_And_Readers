# Точилина Полина БПИ199.
## Микропроект 2, Вариант 3.
###   Задача о читателях и писателях.
Базу данных разделяют два типа процессов – читатели и писатели. Читатели выполняют транзакции, которые просматривают записи базы данных, транзакции писателей и просматривают и изменяют записи. Предполагается, что в начале БД находится в непротиворечивом состоянии (т.е. отношения между данными имеют смысл). Каждая отдельная транзакция переводит БД из одного непротиворечивого состояния в другое. Для предотвращения взаимного влияния транзакций процесс-писатель должен иметь исключительный доступ к БД. Если к БД не обращается ни один из процессов-писателей, то выполнять транзакции могут одновременно сколько угодно читателей. Создать многопоточное приложение с потоками-писателями и потоками-читателями. Реализовать решение, используя семафоры.

Для более удобного представления программы, условие реализовано на ситуации буквальных писателей и читателей некоторых книг.

### Используемая модель
[Источник информации](https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B4%D0%B0%D1%87%D0%B0_%D0%BE_%D1%87%D0%B8%D1%82%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%D1%85-%D0%BF%D0%B8%D1%81%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%D1%85 "Модель читатели и писатели")

В модели есть два типа потоков: 1 - читатель, 2 - писатель. Одновременный доступ получают сколько угодно читателей, но у писателя доступ эксклюзивный.

Для взаимодействия между потоками использованы семафоры.

# Код программы
## includes

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/includes.png "includes")

## Глобальные переменные

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/globals.png "globals")

## Считывание целочисленных значений
Переписан stoi, чтобы не было исключений.

Написан метод, который считывает числа в интервале и сравнивает stoi с начальной строкой, чтобы не пропускать строки, которые просто начинаются с числа.

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/readInt.png "readInt")

# Функция потоков-читателей
## Инициализация
Инициализируется рандомное время видимой работы потока, номер потока и его имя для вывода.

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/reader1.png "reader1")

## Цикл
Поток заходит в цикл с выходом при завершении написания всех книг потоками-авторами. 

Если до этого на данном участке не было других потоков-читателей, то поток блокирует доступ потокам-писателям к базе данных.

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/reader2.png "reader2")

## Выполнение задания
Поток получает рандомную запись в базе данных на чтение.

Если на данном участке не осталось потоков-читателей, то поток открывает доступ потокам-писателям к базе данных.

Поток спит, симулируя чтение книги.

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/reader3.png "reader3")

# Функция потоков-писателей
## Инициализация
Инициализируется рандомное время видимой работы потока, номер потока и его имя для вывода.

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/writer1.png "writer1")

## Цикл
Поток заходит в цикл с выходом при условии, что начато книг столько, сколько должно быть завершено. (Чтобы не написать лишних книг).

Поток засыпает, симулируя написание книги.

Поток добавляет новую запись в базу данных.

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/writer2.png "writer2")

# Функция main
## Приветствие
Инициализируется локаль, рандом и семафоры.

Выводятся сообщения пользователю и происходит ввод начальных значений.

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/main1.png "main1")

## Основная часть
Создаются потоки, симулирующие писателей.

Создаются потоки, симулирующие читателей.

Ожидается окончание работы всех потоков.

Уничтожаются семафоры.

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/main2.png "main2")

# Тестирование программы
## Программа приветствует пользователя

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/hello.png "hello")

## Протестируем проверку ввода целого числа

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/checkInt.png "checkInt")

## Протестируем программу при вводе одинакого количесвта писателей и книг

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/work1.png "work1")

## Протестируем программу на стандартных данных

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/work2.png "work2")

## Протестируем программу при вводе писателей больше чем книг
Лишние книги не были начаты, лишние писатели сразу вышли из цикла.

![alt-текст](https://github.com/LittlePotato14/CSA_Writers_And_Readers/blob/master/screens/work2.png "work2")